#БазыДанных #Конспект #ТРиЗБД #SQL 
Агрегатные функции вычисляют некоторые скалярные зачернения на основе набора строк. В SQLite определены следующие агрегатные функции.

- `AVG` - вычисляет среднее значение 
- `SUM` - вычисляет сумму значений
- `MIN` - вычисляет наименьшее значение
- `MAX` - вычисляет наибольшее значение
- `COUNT` - Вычисляет количество строк в запросе

Все агрегированные функции в качестве параметра принимает выражение, которое представляет критерий для определения значений. Обычно это название столбца, над значениями которого надо проводить вычисления.

### **Avg**

Функция Avg возвращает среднее значение на диапазоне значений столбца таблицы. При этом строки со значением NULL игнорируются.

Например, найдем среднюю цену товаров из базы данных:

```sqlite
SELECT AVG(price) AS average_price FROM products;
```

Для поиска среднего значения в качестве выражения в функцию передается столбец price. Для получаемого значения устанавливается псевдоним average_price, хотя в принципе устанавливать псевдоним необязательно.

Функция **AVG** позволяет находить среднее значение для числового столбца. Например, найдем среднюю цену


```sqlite
SELECT AVG(price)  FROM products WHERE company='Apple';
```

Также можно находить среднее значение для более сложных выражений. Например, найдем среднюю сумму всех товаров, учитывая их количество:

```sqlite
SELECT AVG(price * product_count)  FROM products;
```

Дополнительно функция **AVG** может принимать два оператора:

```sqlite
AVG([ALL | DISTINCT] выражение);
```

Оператор **ALL** указывает, что для вычисления среднего значения будут учитываться все значения, а оператор **DISTINCT** указывает, что учитываются только уникальные значения. Например, вычисление средней цены товаров на основе уникальных значений:

```sqlite
SELECT AVG(DISTINCT price)  FROM products;
```

### **Count**

Функция **COUNT** вычисляет количество строк в выборке. Есть две формы этой функции. Первая`COUNT(*)` подсчитывает число строк в выборке:

```sqlite
SELECT COUNT(*)  FROM products;
```

Вторая форма функции вычисляет количество строк по определенному столбцу, при этом строки со значениями **NULL** иг

```sqlite
SELECT COUNT(company)  FROM products;
```

Однако выражение выше подсчитывает количество всех строк, где в столбце **company** нет значения **NULL**, то есть количество в том числе повторяющихся значений. Чтобы подсчитать количество только уникальных значений, необходимо использовать оператор **DISTINCT**:

```sqlite
SELECT COUNT(DISTINCT company)  FROM products;
```

### **Min и Max**

Функции **MIN** и **MAX** вычисляют минимальное и максимальное значение по столбцу соответственно. Например, найдем минимальную и максимальную цену среди товаров:

```sqlite
SELECT MIN(price), MAX(price)  FROM products;
```

Эти функции также игнорируют значения **NULL** и не учитывают их при подсчете.

### **Sum**

Функция **SUM** вычисляет сумму значений столбца. Если столбец имеет значение **NULL**, то оно игнорируется. Например, подсчитаем общее количество товаров:

```sqlite
SELECT SUM(product_count)  FROM products
```

Также вместо имени столбца может передаваться вычисляемое выражение. Например, найдем общую стоимость всех имеющихся товаров:

```sqlite
SELECT SUM(product_count * price)  FROM products;
```

По умолчанию функция **SUM** вычисляет сумму всех значений, среди которых могут быть повторяющиеся значения. Если необходимо исключить повторяющиеся значения, то можно применять оператор **DISTINCT**. Например, суммарная цена всех товаров на основе уникальных значений:

```sqlite
SELECT SUM(DISTINCT price)  FROM products;
```

### **Комбинирование функций**

Объединим применение нескольких функций:


```sqlite
SELECT COUNT(DISTINCT company) AS companies_count,  
SUM(product_count) AS total_count, 
MIN(price) AS min_price, 
MAX(price) AS max_price, 
AVG(price) AS avg_price FROM products;
```