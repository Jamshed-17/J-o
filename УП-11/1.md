# Отчет по разработке ИС «Телефонная станция»

## 1. Проектирование БД и приведение к 3 нормальной форме (3НФ)

Для соответствия 3НФ данные были распределены по четырем логическим таблицам. Это устраняет избыточность и транзитивные зависимости.

- **Таблица `Subscribers` (Абоненты):** хранит персональные данные. Поля: `id`, `full_name`, `phone_number`, `address`.
    
- **Таблица `Zones` (Зоны):** справочник направлений. Поля: `id`, `name`, `code`, `price_min`. (Выделение в отдельную таблицу позволяет менять цену города один раз для всех звонков).
    
- **Таблица `Calls` (Звонки):** учет совершенных транзакций. Поля: `id`, `subscriber_id`, `zone_id`, `call_date`, `call_time`, `duration`, `total_cost`.
    
- **Таблица `Payments` (Платежи):** учет входящих оплат. Поля: `id`, `subscriber_id`, `amount`, `payment_date`.
    

## 2. Схема БД (Схема связей)

Связи между таблицами реализованы с помощью внешних ключей (Foreign Keys), что обеспечивает целостность данных.

- **Один-ко-многим (1:N):** Один абонент может совершать много звонков и совершать много платежей.
    
- **Один-ко-многим (1:N):** Одна зона (город) может фигурировать во множестве звонков разных абонентов.
    

## 3. Разработка интерфейса программы

Интерфейс реализован в виде веб-приложения с использованием стека:

- **Backend:** FastAPI (Python).
    
- **Frontend:** Jinja2 + Bootstrap 5.
    
- **База данных:** SQLite.
    

Интерфейс включает:

1. **Главная страница:** список абонентов, поиск и кнопка добавления.
    
2. **Страница статистики:** детальная информация по абоненту, расчет задолженности, история звонков и форма оплаты.
    
3. **Панель оператора:** имитация работы станции (регистрация звонка).
    

## 4. CRUD: Ввод, вывод, обновление и удаление данных

В приложении реализован полный цикл управления данными:

- **Создание (Create):** Добавление абонентов через модальное окно и регистрация звонков/платежей через формы.
    
- **Чтение (Read):** Динамический вывод списков из БД на страницы HTML.
    
- **Обновление (Update):** Отдельная форма редактирования данных абонента (`/edit/{id}`).
    
- **Удаление (Delete):** Функция удаления абонента из базы с предварительным подтверждением (`confirm`).
    

## 5. Организация поиска

Поиск реализован на главной странице. Система фильтрует записи в базе данных по частичному совпадению ФИО (используется оператор `contains` в SQLAlchemy).

- _Пример:_ При вводе «Иван» система отобразит всех Иванов, Ивановских и т.д.
    

## 6. Тест-кейсы для тестирования приложения

| **ID**    | **Сценарий**        | **Тестовые данные**                        | **Ожидаемый результат**                     |
| --------- | ------------------- | ------------------------------------------ | ------------------------------------------- |
| **TC-01** | Добавление абонента | ФИО: Тестов Т.Т., Тел: 8999123             | Запись появляется в таблице на главной.     |
| **TC-02** | Дневной звонок      | Зона: Город (2р/мин), Время: 14:00, 10 мин | Стоимость в БД: 20.00 руб.                  |
| **TC-03** | Ночной звонок       | Зона: Город (2р/мин), Время: 01:00, 10 мин | Стоимость: 16.00 руб. (скидка 20%).         |
| **TC-04** | Частичная оплата    | Задолженность 100р, Внесено: 40р           | Задолженность в деталях меняется на 60р.    |
| **TC-05** | Поиск               | Запрос: "Тест"                             | В таблице остается только абонент из TC-01. |

## 7. Реализация бизнес-логики (цена в ночное время)

В коде приложения (файл `main.py`) реализована функция `calculate_price`. Она проверяет объект времени звонка: если час (`hour`) >= 22 или < 6, базовая цена минуты, взятая из таблицы `Zones`, умножается на коэффициент 0.8.

---

**Итог:** Задание выполнено в полном объеме. Система готова к демонстрации.