#БазыДанных #Конспект #ТРиЗБД #SQL 

## Создание базы данных

```sql
-- Создание таблицы "Товары"
CREATE TABLE Товары (
    код_товара INT PRIMARY KEY,
    наименование VARCHAR(255),
    код_категории INT,
    кол INT,
    цена DECIMAL(10, 2)
);

-- Создание таблицы "Категории"
CREATE TABLE Категории (
    код_категории INT PRIMARY KEY,
    наименование VARCHAR(255)
);

-- Создание таблицы "Клиенты"
CREATE TABLE Клиенты (
    код_клиента INT PRIMARY KEY,
    ФИО VARCHAR(255),
    дата_рождения DATE,
    адрес VARCHAR(255),
    телефон VARCHAR(20)
);

-- Создание таблицы "Заказы"
CREATE TABLE Заказы (
    код_заказа INT PRIMARY KEY,
    код_клиента INT,
    код_товара INT,
    кол INT,
    стоимость DECIMAL(10, 2),
    дата DATE,
    FOREIGN KEY (код_клиента) REFERENCES Клиенты(код_клиента),
    FOREIGN KEY (код_товара) REFERENCES Товары(код_товара)
);
```

## Заполнение базы данных тестовыми данными

```sql
INSERT INTO Товары VALUES
(1, 'Блузка синяя', 1, 12, 1990),
(2, 'Кеды высокие', 2, 11, 950),
(3, 'Кроссовки', 2, 16, 2990),
(4, 'Зеленый чай', 3, 23, 160),
(5, 'Мёд', 3, 12, 199),
(6, 'Телефон мини', 4, 2, 1990);

INSERT INTO Категории VALUES
(1, 'одежда'),
(2, 'обувь'),
(3, 'продукты питания'),
(4, 'электроника');

INSERT INTO Клиенты VALUES
(1, 'Мясик Елена Васильевна', '1996-09-12', 'Заречный, Ленина 27', '89567651123'),
(2, 'Кедр Олег Олегович', '1977-12-30', 'Заречный, Ленина 12-2', '89567899009'),
(3, 'Онегин Онег Онегович', '1999-01-12', 'Заречный, Тюльпана 2-12', '89451231122'),
(4, 'Зелень Мария Вольфовна', '2000-08-21', 'Екатеринбург, Вайнера 22-123', '89567897755'),
(5, 'Мёдик Снежана Борисовна', '2001-11-11', 'Екатеринбург, Зеленая 2-23', '89567899900'),
(6, 'Телец Сергей Иванович', '1990-06-09', 'Челябинск, Верная 22-123', '89671234111');

INSERT INTO Заказы VALUES
(1, 2, 4, 2, 320, '2022-04-19'),
(2, 1, 3, 1, 2990, '2022-04-12'),
(3, 3, 1, 2, 3980, '2022-04-18'),
(4, 4, 5, 3, 597, '2022-04-15'),
(5, 5, 4, 1, 160, '2022-04-19'),
(6, 1, 2, 1, 950, '2022-04-01');
```
### Запросы

**1: Вывести наименование товаров и их категории**
```sql
SELECT t.наименование, c.наименование AS категория
FROM Товары t
JOIN Категории c ON t.код_категории = c.код_категории;
```

**2: Вывести товар, который заказали больше всего раз**
```sql
SELECT t.наименование, SUM(z.кол) AS общее_количество
FROM Заказы z
JOIN Товары t ON z.код_товара = t.код_товара
GROUP BY t.наименование
ORDER BY общее_количество DESC
LIMIT 1;
```

**3: Вывести товар, который заказал клиент с именем «Мария» и его категорию**
```sql
SELECT t.наименование, c.наименование AS категория
FROM Заказы z
JOIN Клиенты k ON z.код_клиента = k.код_клиента
JOIN Товары t ON z.код_товара = t.код_товара
JOIN Категории c ON t.код_категории = c.код_категории
WHERE k.ФИО LIKE '%Мария%';
```

**4: Вывести товар, который заказали раньше всех остальных**
```sql
SELECT t.наименование, MIN(z.дата) AS дата_первого_заказа
FROM Заказы z
JOIN Товары t ON z.код_товара = t.код_товара
GROUP BY t.наименование
ORDER BY дата_первого_заказа ASC
LIMIT 1;
```

**5: Вывести заказы, ФИО клиента, и если стоимость заказа меньше 1000, то прибавить к стоимости 200 за доставку**
```sql
SELECT z.код_заказа, k.ФИО, 
       z.стоимость + CASE WHEN z.стоимость < 1000 THEN 200 ELSE 0 END AS стоимость_с_доставкой
FROM Заказы z
JOIN Клиенты k ON z.код_клиента = k.код_клиента;
```

**6: Вывести клиентов, возраст которых больше среднего**
```sql
SELECT k.ФИО, YEAR(CURDATE()) - YEAR(k.дата_рождения) AS возраст
FROM Клиенты k
WHERE YEAR(CURDATE()) - YEAR(k.дата_рождения) > (
    SELECT AVG(YEAR(CURDATE()) - YEAR(дата_рождения)) FROM Клиенты
);
```

**7: Вывести заказ, стоимость которого наибольшая**
```sql
SELECT *
FROM Заказы
ORDER BY стоимость DESC
LIMIT 1;
```

**8: Сделать скидку 7% от стоимости заказа, где стоимость превышает 3000**
```sql
SELECT z.код_заказа, z.стоимость, 
       CASE WHEN z.стоимость > 3000 THEN z.стоимость * 0.93 ELSE z.стоимость END AS стоимость_со_скидкой
FROM Заказы z;
```

**9: Вывести клиентов с фамилией на букву «О»**
```sql
SELECT *
FROM Клиенты
WHERE ФИО LIKE 'О%';
```

**10: Вывести товары, которые относятся к категории «Обувь»**
```sql
SELECT t.*
FROM Товары t
JOIN Категории c ON t.код_категории = c.код_категории
WHERE c.наименование = 'обувь';
```

**11: Вывести ФИО клиентов, которые заказали продукты питания**
```sql
SELECT DISTINCT k.ФИО
FROM Заказы z
JOIN Клиенты k ON z.код_клиента = k.код_клиента
JOIN Товары t ON z.код_товара = t.код_товара
JOIN Категории c ON t.код_категории = c.код_категории
WHERE c.наименование = 'продукты питания';
```

**12: Вывести клиентов, которые родились зимой**
```sql
SELECT *
FROM Клиенты
WHERE MONTH(дата_рождения) IN (12, 1, 2);
```
