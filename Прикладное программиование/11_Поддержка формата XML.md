**1. В чем отличия документа XML от фрагмента документа XML?

- **Документ XML** имеет строго **один корневой элемент**, может содержать пролог (XML-декларацию) и является полноценным XML-документом.
    
- **Фрагмент XML** может содержать **несколько элементов верхнего уровня** или даже текстовые узлы без единого корневого элемента. Фрагмент не обязательно является корректным XML-документом, но может быть частью большего документа.

**2. Какие требования предъявляются к корректно сформированному документу XML? В чем отличия требования к валидному документу XML?**

1. **Обязателен один корневой элемент** (ровно один элемент верхнего уровня).
    
2. **Все элементы должны быть правильно вложены** и иметь парные открывающие и закрывающие теги (или самозакрывающиеся).
    
3. **Атрибуты должны быть заключены в кавычки** (одинарные или двойные).
    
4. **Имена элементов и атрибутов чувствительны к регистру** и должны соответствовать правилам именования.
    
5. **Специальные символы должны быть экранированы** (`&`, `<`, `>`, `"`, `'`).

**Отличия требований к валидному документу XML:**

- **Валидный документ XML** должен не только быть корректно сформированным, но и **соответствовать схеме** (XML Schema, DTD), которая определяет структуру, типы данных и ограничения.
    
- Корректно сформированный документ может не иметь схемы, валидный — всегда проверяется по схеме.

**3. Опишите режимы использования инструкции FOR XML.

1. **FOR XML RAW**
    
    - Преобразует **каждую строку** результата в элемент `<row>` (или с другим именем).
        
    - Столбцы становятся **атрибутами** элемента.
        
2. **FOR XML AUTO**
    
    - Автоматически создает **вложенную структуру** на основе JOIN.
        
    - Имена элементов соответствуют именам таблиц/алиасов.
        
    - Столбцы по умолчанию — атрибуты, но можно использовать `ELEMENTS`.
        
3. **FOR XML EXPLICIT**
    
    - Позволяет **полностью контролировать структуру** XML.
        
    - Требует сложного формирования результата с метаданными.
        
    - Редко используется из-за сложности.
        
4. **FOR XML PATH**
    
    - Гибкий режим, **позволяет смешивать атрибуты и элементы**.
        
    - Можно задавать **вложенность и пути** с помощью псевдонимов столбцов.
        
    - Часто используется для создания сложных XML-структур.

**Общие опции:**

- `ROOT('имя')` — добавляет корневой элемент.
    
- `ELEMENTS` — выводит столбцы как элементы, а не атрибуты.
    
- `ELEMENTS XSINIL` — включает элементы для NULL-значений.
    
- `TYPE` — возвращает результат как тип `xml` (для вложенных запросов).


4. SELECT id as 'StudID', fam as 'Фамилия' FROM student FOR XML PATH('student'), ROOT('Students')

5. 

DECLARE @xml XML

SET @xml = (
	SELECT id as 'Номер', fam as 'Фамилия' FROM student FOR XML PATH('Student'), ROOT('Students')
)

SELECT @xml

SELECT 
	CASE 
		WHEN @xml.exist('/Students/Student[Фамилия="Миротина"]') = 1
		THEN 'Найден'
		ELSE 'Не найден'
	END as Result