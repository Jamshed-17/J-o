#SQL #Конспект #БазыДанных 

```mysql
-- Создание базы данных
CREATE DATABASE Корабли;
GO

USE Корабли;
GO

-- Создание таблиц
CREATE TABLE Классы (
    ИмяКласса NVARCHAR(50) PRIMARY KEY,
    Тип NVARCHAR(2) CHECK (Тип IN ('bb', 'bc')),
    Страна NVARCHAR(50),
    ЧислоОрудий INT,
    КалибрОрудий INT,
    Водоизмещение INT
);

CREATE TABLE Корабли (
    НазваниеКорабля NVARCHAR(50) PRIMARY KEY,
    Класс NVARCHAR(50) FOREIGN KEY REFERENCES Классы(ИмяКласса),
    ГодСпускаНаВоду INT
);

CREATE TABLE Битвы (
    НазваниеБитвы NVARCHAR(50) PRIMARY KEY,
    ДатаБитвы DATE
);

CREATE TABLE Сражения (
    НазваниеКорабля NVARCHAR(50) FOREIGN KEY REFERENCES Корабли(НазваниеКорабля),
    НазваниеБитвы NVARCHAR(50) FOREIGN KEY REFERENCES Битвы(НазваниеБитвы),
    РезультатБитвы NVARCHAR(10) CHECK (РезультатБитвы IN ('sunk', 'damaged', 'ok')),
    PRIMARY KEY (НазваниеКорабля, НазваниеБитвы)
);
GO

-- Заполнение таблицы Классы
INSERT INTO Классы VALUES 
('Bismarck', 'bb', 'Germany', 8, 15, 42000),
('Iowa', 'bb', 'USA', 9, 16, 46000),
('Kongo', 'bc', 'Japan', 8, 14, 32000),
('North Carolina', 'bb', 'USA', 9, 16, 37000),
('Renown', 'bc', 'Great Britain', 6, 15, 32000),
('Revenge', 'bb', 'Great Britain', 8, 15, 29000),
('Tennessee', 'bb', 'USA', 12, 14, 32000),
('Yamato', 'bb', 'Japan', 9, 18, 65000);
GO

-- Заполнение таблицы Корабли
INSERT INTO Корабли VALUES 
('California', 'Tennessee', 1921),
('Haruna', 'Kongo', 1915),
('Hiei', 'Kongo', 1914),
('Iowa', 'Iowa', 1943),
('Kirishima', 'Kongo', 1915),
('Kongo', 'Kongo', 1913),
('Missouri', 'Iowa', 1944),
('Musashi', 'Yamato', 1942),
('New Jersey', 'Iowa', 1943),
('North Carolina', 'North Carolina', 1941),
('Ramillies', 'Revenge', 1917),
('Renown', 'Renown', 1916),
('Repulse', 'Renown', 1916),
('Resolution', 'Revenge', 1916),
('Revenge', 'Revenge', 1916),
('Royal Oak', 'Revenge', 1916),
('Royal Sovereign', 'Revenge', 1916),
('Tennessee', 'Tennessee', 1920),
('Washington', 'North Carolina', 1941),
('Wisconsin', 'Iowa', 1944),
('Yamato', 'Yamato', 1941);
GO

-- Заполнение таблицы Битвы
INSERT INTO Битвы VALUES 
('North Atlantic', '1941-05-24'),
('Guadalcanal', '1942-11-15'),
('North Cape', '1943-12-26'),
('Surigao Strait', '1944-10-25'),
('Denmark Strait', '1941-05-24'),
('Leyte Gulf', '1944-10-25');
GO

-- Заполнение таблицы Сражения
INSERT INTO Сражения VALUES 
('Bismarck', 'Denmark Strait', 'sunk'),
('California', 'Surigao Strait', 'ok'),
('Duke of York', 'North Cape', 'ok'),
('Fuso', 'Surigao Strait', 'sunk'),
('Hood', 'Denmark Strait', 'sunk'),
('King George V', 'Denmark Strait', 'ok'),
('Kirishima', 'Guadalcanal', 'sunk'),
('Prince of Wales', 'Denmark Strait', 'damaged'),
('Rodney', 'Denmark Strait', 'ok'),
('Schamhorst', 'North Cape', 'sunk'),
('South Dakota', 'Guadalcanal', 'damaged'),
('Tennessee', 'Surigao Strait', 'ok'),
('Washington', 'Guadalcanal', 'ok'),
('West Virginia', 'Surigao Strait', 'ok'),
('Yamashiro', 'Surigao Strait', 'sunk'),
('California', 'Leyte Gulf', 'damaged');
GO

-- ВЫПОЛНЕНИЕ ЗАДАНИЙ

-- 1. Для классов кораблей, калибр орудий которых не менее 16 дюймов, вывести класс и страна
SELECT ИмяКласса, Страна 
FROM Классы 
WHERE КалибрОрудий >= 16;

-- 2. Найти корабли, спущенные на воду до 1921 года, вывести name и launched
SELECT НазваниеКорабля, ГодСпускаНаВоду 
FROM Корабли 
WHERE ГодСпускаНаВоду < 1921;

-- 3. Найти корабли, потопленные в сражениях North Cape, вывести ship, battle, result
SELECT s.НазваниеКорабля, s.НазваниеБитвы, s.РезультатБитвы 
FROM Сражения s 
WHERE s.НазваниеБитвы = 'North Cape' AND s.РезультатБитвы = 'sunk';

-- 4. По Вашингтонскому договору - корабли, нарушившие договор (линейные корабли > 35000 тонн после 1922)
SELECT k.НазваниеКорабля, kl.Водоизмещение, k.ГодСпускаНаВоду 
FROM Корабли k 
JOIN Классы kl ON k.Класс = kl.ИмяКласса 
WHERE kl.Тип = 'bb' AND kl.Водоизмещение > 35000 AND k.ГодСпускаНаВоду >= 1922;

-- 5. Вывести названия головных кораблей
SELECT k.НазваниеКорабля 
FROM Корабли k 
JOIN Классы kl ON k.Класс = kl.ИмяКласса 
WHERE k.НазваниеКорабля = kl.ИмяКласса;

-- 6. Найти класс, имя, страну для кораблей из таблицы ships, имеющих не менее 10 орудий
SELECT k.Класс, k.НазваниеКорабля, kl.Страна 
FROM Корабли k 
JOIN Классы kl ON k.Класс = kl.ИмяКласса 
WHERE kl.ЧислоОрудий >= 10;

-- 7. Найти названия кораблей из базы данных, спущенных на воду до 1941
SELECT НазваниеКорабля 
FROM Корабли 
WHERE ГодСпускаНаВоду < 1941;

-- 8. Найти названия кораблей и названия сражений, в которых они были потоплены
SELECT s.НазваниеКорабля, s.НазваниеБитвы 
FROM Сражения s 
WHERE s.РезультатБитвы = 'sunk';

-- 9. Определить общее количество потопленных кораблей
SELECT COUNT(*) AS КоличествоПотопленныхКораблей 
FROM Сражения 
WHERE РезультатБитвы = 'sunk';

-- 10. Определить сколько кораблей участвовало в каждом сражении
SELECT НазваниеБитвы, COUNT(*) AS КоличествоКораблей 
FROM Сражения 
GROUP BY НазваниеБитвы;

-- 11. Определить количество кораблей, выпущенных каждой страной
SELECT kl.Страна, COUNT(*) AS КоличествоКораблей 
FROM Корабли k 
JOIN Классы kl ON k.Класс = kl.ИмяКласса 
GROUP BY kl.Страна;

-- 12. Найти названия всех кораблей, начинающихся с буквы R
SELECT НазваниеКорабля 
FROM Корабли 
WHERE НазваниеКорабля LIKE 'R%';

-- 13. Найти названия всех кораблей состоящих из 2 слов
SELECT НазваниеКорабля 
FROM Корабли 
WHERE НазваниеКорабля LIKE '% %' AND НазваниеКорабля NOT LIKE '% % %';

-- 14. Найти классы и страны, корабли которых имеют наибольшее число орудий
SELECT ИмяКласса, Страна, ЧислоОрудий 
FROM Классы 
WHERE ЧислоОрудий = (SELECT MAX(ЧислоОрудий) FROM Классы);

-- 15. Найти классы кораблей, в которых хотя бы 1 корабль был потоплен в сражении
SELECT DISTINCT k.Класс 
FROM Корабли k 
JOIN Сражения s ON k.НазваниеКорабля = s.НазваниеКорабля 
WHERE s.РезультатБитвы = 'sunk';

-- 16. Найти названия кораблей с орудиями калибра 16 дюймов
SELECT k.НазваниеКорабля 
FROM Корабли k 
JOIN Классы kl ON k.Класс = kl.ИмяКласса 
WHERE kl.КалибрОрудий = 16;

-- 17. Найти сражения, в которых участвовали корабли класса Kongo
SELECT DISTINCT s.НазваниеБитвы 
FROM Сражения s 
JOIN Корабли k ON s.НазваниеКорабля = k.НазваниеКорабля 
WHERE k.Класс = 'Kongo';

-- 18. Найти количество классов линейных кораблей
SELECT COUNT(*) AS КоличествоЛинейныхКораблей 
FROM Классы 
WHERE Тип = 'bb';

-- 19. Найти среднее число орудий для классов линейных кораблей
SELECT AVG(ЧислоОрудий) AS СреднееЧислоОрудий 
FROM Классы 
WHERE Тип = 'bb';

-- 20. Найти класс и год, в котором был спущен первый корабль этого класса
SELECT Класс, MIN(ГодСпускаНаВоду) AS ПервыйГодСпуска 
FROM Корабли 
GROUP BY Класс;
```