#SQL #Конспект #БазыДанных 

## Создание базы данных и таблиц

```mysql
CREATE DATABASE Ships;
USE Ships;

CREATE TABLE Classes (
    ClassName NVARCHAR(50) PRIMARY KEY,
    Type NVARCHAR(2),
    Country NVARCHAR(50),
    NumGuns INT,
    Bore INT,
    Displacement INT
);

CREATE TABLE Ships (
    ShipName NVARCHAR(50) PRIMARY KEY,
    Class NVARCHAR(50),
    Launched INT,
    FOREIGN KEY (Class) REFERENCES Classes(ClassName)
);

CREATE TABLE Battles (
    BattleName NVARCHAR(50) PRIMARY KEY,
    BattleDate DATE
);

CREATE TABLE Outcomes (
    ShipName NVARCHAR(50),
    BattleName NVARCHAR(50),
    Result NVARCHAR(10),
    PRIMARY KEY (ShipName, BattleName),
    FOREIGN KEY (ShipName) REFERENCES Ships(ShipName),
    FOREIGN KEY (BattleName) REFERENCES Battles(BattleName)
);
```

## Заполнение таблиц данными

```mysql
INSERT INTO Classes VALUES 
('Bismarck', 'bb', 'Germany', 8, 15, 42000),
('Iowa', 'bb', 'USA', 9, 16, 46000),
('Kongo', 'bc', 'Japan', 8, 14, 32000);

INSERT INTO Ships VALUES 
('California', 'Tennessee', 1921),
('Haruna', 'Kongo', 1915),
('Iowa', 'Iowa', 1943);

INSERT INTO Battles VALUES 
('North Atlantic', '1941-05-24'),
('Guadalcanal', '1942-11-15'),
('North Cape', '1943-12-26');

INSERT INTO Outcomes VALUES 
('Bismarck', 'Denmark Strait', 'sunk'),
('California', 'Surigao Strait', 'ok'),
('Kirishima', 'Guadalcanal', 'sunk');
```

## Задания и решения

### Задание 1: Для классов кораблей, калибр орудий которых не менее 16 дюймов, вывести класс и страна
```mysql
SELECT ClassName, Country 
FROM Classes 
WHERE Bore >= 16;
```

### Задание 2: Найти корабли, спущенные на воду до 1921 года, вывести name и launched
```mysql
SELECT ShipName, Launched 
FROM Ships 
WHERE Launched < 1921;
```

### Задание 3: Найти корабли, потопленные в сражениях North Cape, вывести ship, battle, result
```mysql
SELECT o.ShipName, o.BattleName, o.Result 
FROM Outcomes o 
WHERE o.BattleName = 'North Cape' AND o.Result = 'sunk';
```

### Задание 4: Найти корабли, нарушившие Вашингтонский договор (линейные корабли > 35000 тонн после 1922)
```mysql
SELECT s.ShipName, c.Displacement, s.Launched 
FROM Ships s 
JOIN Classes c ON s.Class = c.ClassName 
WHERE c.Type = 'bb' AND c.Displacement > 35000 AND s.Launched >= 1922;
```

### Задание 5: Вывести названия головных кораблей
```mysql
SELECT s.ShipName 
FROM Ships s 
JOIN Classes c ON s.Class = c.ClassName 
WHERE s.ShipName = c.ClassName;
```

### Задание 6: Найти класс, имя, страну для кораблей из таблицы ships, имеющих не менее 10 орудий
```mysql
SELECT s.Class, s.ShipName, c.Country 
FROM Ships s 
JOIN Classes c ON s.Class = c.ClassName 
WHERE c.NumGuns >= 10;
```

### Задание 7: Найти названия кораблей из базы данных, спущенных на воду до 1941
```mysql
SELECT ShipName 
FROM Ships 
WHERE Launched < 1941;
```

### Задание 8: Найти названия кораблей и названия сражений, в которых они были потоплены
```mysql
SELECT o.ShipName, o.BattleName 
FROM Outcomes o 
WHERE o.Result = 'sunk';
```

### Задание 9: Определить общее количество потопленных кораблей
```mysql
SELECT COUNT(*) AS SunkenShipsCount 
FROM Outcomes 
WHERE Result = 'sunk';
```

### Задание 10: Определить сколько кораблей участвовало в каждом сражении
```mysql
SELECT BattleName, COUNT(*) AS ShipsCount 
FROM Outcomes 
GROUP BY BattleName;
```

### Задание 11: Определить количество кораблей, выпущенных каждой страной
```mysql
SELECT c.Country, COUNT(*) AS ShipsCount 
FROM Ships s 
JOIN Classes c ON s.Class = c.ClassName 
GROUP BY c.Country;
```

### Задание 12: Найти названия всех кораблей, начинающихся с буквы R
```mysql
SELECT ShipName 
FROM Ships 
WHERE ShipName LIKE 'R%';
```

### Задание 13: Найти названия всех кораблей состоящих из 2 слов
```mysql
SELECT ShipName 
FROM Ships 
WHERE ShipName LIKE '% %' AND ShipName NOT LIKE '% % %';
```

### Задание 14: Найти классы и страны, корабли которых имеют наибольшее число орудий
```mysql
SELECT ClassName, Country, NumGuns 
FROM Classes 
WHERE NumGuns = (SELECT MAX(NumGuns) FROM Classes);
```

### Задание 15: Найти классы кораблей, в которых хотя бы 1 корабль был потоплен в сражении
```mysql
SELECT DISTINCT s.Class 
FROM Ships s 
JOIN Outcomes o ON s.ShipName = o.ShipName 
WHERE o.Result = 'sunk';
```

### Задание 16: Найти названия кораблей с орудиями калибра 16 дюймов
```mysql
SELECT s.ShipName 
FROM Ships s 
JOIN Classes c ON s.Class = c.ClassName 
WHERE c.Bore = 16;
```

### Задание 17: Найти сражения, в которых участвовали корабли класса Kongo
```mysql
SELECT DISTINCT o.BattleName 
FROM Outcomes o 
JOIN Ships s ON o.ShipName = s.ShipName 
WHERE s.Class = 'Kongo';
```

### Задание 18: Найти количество классов линейных кораблей
```mysql
SELECT COUNT(*) AS BattleshipClassesCount 
FROM Classes 
WHERE Type = 'bb';
```

### Задание 19: Найти среднее число орудий для классов линейных кораблей
```mysql
SELECT AVG(NumGuns) AS AvgNumGuns 
FROM Classes 
WHERE Type = 'bb';
```

### Задание 20: Найти класс и год, в котором был спущен первый корабль этого класса
```mysql
SELECT Class, MIN(Launched) AS FirstLaunchYear 
FROM Ships 
GROUP BY Class;
```

