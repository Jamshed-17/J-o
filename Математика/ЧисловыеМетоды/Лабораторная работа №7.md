**ВАРИАНТ 1**

**Название:** Численное интегрирование.

**Цель:** Изучение методов численного интегрирования (формулы трапеций и Симпсона), оценка погрешности с использованием правила Рунге и сравнение полученных приближенных значений с точным аналитическим решением.

---

## 2. Постановка задачи

**Вариант 1:**
Вычислить определенный интеграл:
$$\int_{1}^{2}\frac{x^4}{1+x^2}dx$$
Требуемая точность для формулы трапеций: $\varepsilon = 0.001$.

---

## 3. Выведенные вспомогательные формулы и функции

**Интегрируемая функция:** $f(x) = \frac{x^4}{1+x^2}$

**1. Глобальная формула трапеций**
$$I_{Tp}(h) = h \left( \frac{y_0 + y_n}{2} + \sum_{i=1}^{n-1} y_i \right), \quad \text{где } h = \frac{b-a}{n}$$

**2. Оценка погрешности формулы трапеций**
$$|R_n| \le M\frac{|b-a|h^2}{12}, \quad \text{где } M = \max |f^{\prime\prime}(x)|, x \in [a,b]$$

**3. Глобальная формула Симпсона** (для четного $n=2m$)
$$I_C(h) = \frac{h}{3} \left( y_0 + y_n + 4 \sum_{i=1}^{m} y_{2i-1} + 2 \sum_{i=1}^{m-1} y_{2i} \right)$$

**4. Правило Рунге для уточнения погрешности**
$$\text{Погрешность} \approx \frac{|I(h) - I(2h)|}{2^{p} - 1}$$
* Для формулы трапеций ($p=2$):
    $$R_{Tp} \approx \frac{|I_{Tp}(h) - I_{Tp}(2h)|}{3}$$
* Для формулы Симпсона ($p=4$):
    $$R_{C} \approx \frac{|I_C(h) - I_C(2h)|}{15}$$

---

## 4. Таблицы с результатами расчётов

### 4.1. Определение шага интегрирования $h$ (Формула трапеций, $\varepsilon=0.001$)

1.  **Вторая производная** (используется преобразованный вид $f(x) = x^2 - 1 + (1+x^2)^{-1}$):
    $$f^{\prime\prime}(x) = 2 - \frac{2(1 - 3x^2)}{(1+x^2)^3}$$
2.  **Максимальное значение $|f^{\prime\prime}(x)|$** на отрезке $[1, 2]$:
    * $|f^{\prime\prime}(1)| = 2.5$
    * $|f^{\prime\prime}(2)| \approx 2.176$
    * $M = \max |f^{\prime\prime}(x)| \approx 2.5$
3.  **Расчет шага $h$:**
    $$M \frac{|b-a|h^2}{12} < \varepsilon \implies 2.5 \frac{1 \cdot h^2}{12} < 0.001$$
    $$h^2 < 0.0048 \implies h < 0.06928$$
4.  **Выбор $n$ и $h$:**
    * $n > \frac{b-a}{h} \approx \frac{1}{0.06928} \approx 14.43$
    * Выбираем $n$ кратное 4, ближайшее $\ge 14.43$: $\mathbf{n = 16}$.
    * **Шаг** $h = \frac{2-1}{16} = \mathbf{0.0625}$.

### 4.2. Численное интегрирование и оценка погрешности

| Метод | $n$ | $h$ | Значение интеграла $I(h)$ | Оценка погрешности $R$ (по Рунге) | Результат $I \pm R$ |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **Трапеций** | 16 | 0.062500 | 1.65514008 | 0.00008174 | $1.6551 \pm 0.0001$ |
| Трапеций | 8 | 0.125000 | 1.65538531 | | |
| **Симпсона** | 16 | 0.062500 | 1.65508426 | 0.000000004 | $1.655084 \pm 4 \cdot 10^{-9}$ |
| Симпсона | 8 | 0.125000 | 1.65508432 | | |

---

## 5. Точное решение

Используя формулу Ньютона-Лейбница:
$$\int_{1}^{2}\frac{x^4}{1+x^2}dx = \int_{1}^{2}\left(x^2 - 1 + \frac{1}{1+x^2}\right)dx$$
$$\left[\frac{x^3}{3} - x + \arctan x\right]_{1}^{2} = \left(\frac{8}{3} - 2 + \arctan 2\right) - \left(\frac{1}{3} - 1 + \arctan 1\right)$$
$$= \frac{4}{3} + \arctan 2 - \frac{\pi}{4}$$

**Точное значение интеграла:** $I_{\text{точн}} \approx 1.65508431$

---

## 6. Анализ полученных результатов и выводы

**Сравнение:**

| Метод | Приближенное $I$ | Погрешность $R$ (по Рунге) | Абс. погрешность ($|I - I_{\text{точн}}|$)|
| :---: | :---: | :---: | :---: |
| **Трапеций** | 1.65514008 | $8.17 \cdot 10^{-5}$ | $5.58 \cdot 10^{-5}$ |
| **Симпсона** | 1.65508426 | $4 \cdot 10^{-9}$ | $5 \cdot 10^{-8}$ |

1.  **Формула трапеций** дала результат $I_{Tp} \approx 1.655140$ с погрешностью $R_{Tp} \approx 8.17 \cdot 10^{-5}$. Эта погрешность удовлетворяет заданной точности $\varepsilon = 0.001$.
2.  **Формула Симпсона** дала значительно более точный результат $I_C \approx 1.655084$ с погрешностью порядка $10^{-9}$, что на несколько порядков точнее.

**Вывод:** Как и ожидалось, формула Симпсона, имеющая более высокий порядок точности ($p=4$) по сравнению с формулой трапеций ($p=2$), дала более точный результат интегрирования, подтверждая теоретическое преимущество методов, основанных на интерполяции полиномами более высокого порядка.

---

## Листинг программы на Python

```python
import math
import numpy as np

# --- 1. Целевая функция ---
def f(x):
    """f(x) = x^4 / (1 + x^2)"""
    return (x**4) / (1 + x**2)

# --- 2. Численные методы ---

def trapezoidal_rule(a, b, n):
    """Глобальная формула трапеций."""
    h = (b - a) / n
    x = np.linspace(a, b, n + 1)
    y = f(x)
    
    # Сумма: h * ( (y0 + yn)/2 + y1 + ... + y(n-1) )
    integral = h * ( (y[0] + y[-1]) / 2 + np.sum(y[1:-1]) )
    return integral, h

def simpsons_rule(a, b, n):
    """Глобальная формула Симпсона (n должно быть четным)."""
    if n % 2 != 0:
        raise ValueError("Для формулы Симпсона количество интервалов n должно быть четным.")
        
    h = (b - a) / n
    x = np.linspace(a, b, n + 1)
    y = f(x)
    
    # Сумма: h/3 * (y0 + 4*sum_odd + 2*sum_even + yn)
    sum_odd = np.sum(y[1:-1:2]) # y1, y3, y5...
    sum_even = np.sum(y[2:-1:2]) # y2, y4, y6...
    
    integral = (h / 3) * (y[0] + 4 * sum_odd + 2 * sum_even + y[-1])
    return integral, h

def runge_error_estimation(I_h, I_2h, p):
    """Правило Рунге: I - I(h) ≈ |I(h) - I(2h)| / (2^p - 1)"""
    return abs(I_h - I_2h) / (2**p - 1)

# --- 3. Аналитическое решение ---

def exact_integral(a, b):
    """Точное решение: [x^3/3 - x + arctan(x)] от a до b"""
    def F(x):
        return (x**3 / 3) - x + math.atan(x)
    return F(b) - F(a)

# --- 4. Основная программа ---
if __name__ == "__main__":
    
    # Входные данные
    a = 1.0
    b = 2.0
    epsilon = 0.001
    N_INITIAL = 16 # n кратное 4, N > 14.43
    N_2H = N_INITIAL // 2 # n для шага 2h
    
    print("--- Лабораторная работа №7. Численное интегрирование (Вариант 1) ---")
    print(f"Функция: f(x) = x^4 / (1 + x^2)")
    print(f"Интервал: [{a}, {b}], Требуемая точность (Трапеций): {epsilon}\n")

    # --- 1. Точное решение ---
    I_exact = exact_integral(a, b)
    print(f"1. Точное аналитическое значение: I_точн ≈ {I_exact:.8f}\n")
    
    print("-" * 50)
    print(f"2. Формула Трапеций (порядок p=2)")
    print(f"   Базовый шаг h: n={N_INITIAL}, h={(b-a)/N_INITIAL:.6f}")
    print(f"   Удвоенный шаг 2h: n={N_2H}, h={(b-a)/N_2H:.6f}")
    
    # Расчет по формуле трапеций
    I_Tp_h, h_Tp = trapezoidal_rule(a, b, N_INITIAL)
    I_Tp_2h, h_Tp_2h = trapezoidal_rule(a, b, N_2H)
    
    # Оценка погрешности по Рунге
    R_Tp = runge_error_estimation(I_Tp_h, I_Tp_2h, p=2)
    
    print(f"   I_Tp(h) = {I_Tp_h:.8f}")
    print(f"   I_Tp(2h) = {I_Tp_2h:.8f}")
    print(f"   R_Tp (по Рунге) ≈ {R_Tp:.8f}")
    print(f"   Абс. погрешность: |I_Tp(h) - I_точн| = {abs(I_Tp_h - I_exact):.8f}")
    
    print("-" * 50)
    print(f"3. Формула Симпсона (порядок p=4)")
    
    # Расчет по формуле Симпсона
    I_C_h, h_C = simpsons_rule(a, b, N_INITIAL)
    I_C_2h, h_C_2h = simpsons_rule(a, b, N_2H)

    # Оценка погрешности по Рунге
    R_C = runge_error_estimation(I_C_h, I_C_2h, p=4)
    
    print(f"   I_C(h) = {I_C_h:.8f}")
    print(f"   I_C(2h) = {I_C_2h:.8f}")
    print(f"   R_C (по Рунге) ≈ {R_C:.8f}")
    print(f"   Абс. погрешность: |I_C(h) - I_точн| = {abs(I_C_h - I_exact):.8f}")
    print("-" * 50)
    
    # Сравнение
    print("\n4. Сравнение результатов:")
    if R_C < R_Tp:
        print("   Формула Симпсона дала более точный результат, что соответствует теории.")
    else:
        print("   Произошла ошибка в расчетах или функция имеет особенности.")
```