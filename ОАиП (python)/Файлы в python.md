#ОАиП #Программирование #python #ФункцииPython #Конспект 


- **Файл** — это всего лишь набор данных, сохраненный в виде последовательности битов на компьютере. Информация хранится в куче данных (структура данных) и имеет название «имя файла» (filename).

Для работы с файлами в Python используется функция **open()**. Она принимает два аргумента: имя файла и режим открытия файла.

---


#### Режимы открытия могут быть следующие:
- ‘r’ — чтение (по умолчанию);
- ‘w’ — запись (если файл не существует, он будет создан);
- ‘a’ — добавление (открывает файл для добавления новых данных);
- ‘x’ — создание (создает новый файл, если он уже существует, вызывается исключение);
- ‘b’ — двоичный режим (используется для работы с двоичными файлами, например, изображениями).

Не забывайте закрывать файл после окончания работы с ним, используя метод **close()**.

---
#### Для чтения содержимого файла можно использовать несколько методов:
- read(size) — считывает из файла указанное количество символов (или весь файл, если size не указан);
- readline() — считывает одну строку из файла;
- readlines() — считывает все строки файла в список.

---

Для записи данных в файл используется метод **write(text)**. Он принимает один аргумент — текст, который нужно записать в файл. Если файл открыт в режиме **‘w’**, то все существующие данные будут стёрты, а новые добавлены.

- Для открытия файлов в python используется функция open: **file= open ("/ path/for/your/file.txt", " r")**. Она возвращает поток - интерфейс взаимодействия с содержимым файла. Функция open принимает первым аргументом полное имя файла (с путём, абсолютным или относительным), вторым - режим, в котором мы откроем файл.

![[Рисунок1.png]]

---

Для чтения данных из файла можно использовать следующие методы:

- **readline()** — считывает одну строку из файла до символа конца строки «\n» и возвращает считанную строку вместе с символом «\n». Если считывание не было успешно (достигнут конец файла), то возвращается пустая строка.

- **readlines()** — считывает все строки из файла и возвращает список из всех считанных строк (одна строка — один элемент списка). При этом символы «\n» остаются в концах строк.

- **read()** — считывает всё содержимое из файла и возвращает строку, которая может содержать символы «\n». Если методу read передать целочисленный параметр, то будет считано не более заданного количества символов.

![[Рисунок2.png]]

---

Для записи данных в файл можно использовать следующие методы:

- Метод **write()** — используется для записи данных из строковой переменной. Метод возвращает количество записанных в файл символов.
![[Рисунок3.png]]

- Метод **writelines()** — используется для записи строк из списка в файл. Этот метод записывает строки в файл по очереди, без разделителя.
![[Рисунок4.png]]

---
---
---

В Python существует два типа файлов:

1. Текстовые
2. Бинарные

### Текстовые файлы

Это файлы с человеко-читаемым содержимым. В них хранятся последовательности символов, которые понимает человек. Блокнот и другие стандартные редакторы умеют читать и редактировать этот тип файлов.

Текст может храниться в двух форматах: (`.txt`) — простой текст и (`.rtf`) — «формат обогащенного текста».

### Бинарные файлы

В бинарных файлах данные отображаются в закодированной форме (с использованием только нулей (0) и единиц (1) вместо простых символов). В большинстве случаев это просто последовательности битов.

Они хранятся в формате `.bin`.

Любую операцию с файлом можно разбить на три крупных этапа:

1. Открытие файла
2. Выполнение операции (запись, чтение)
3. Закрытие файла

## Открытие файла

### Метод open()

В Python есть встроенная функция `open()`. С ее помощью можно открыть любой файл на компьютере. Технически Python создает на его основе объект.

Синтаксис следующий:

```py
f = open(file_name, access_mode)
```

Где,

- `file_name` = имя открываемого файла
- `access_mode` = режим открытия файла. Он может быть: для чтения, записи и т. д. По умолчанию используется режим чтения (`r`), если другое не указано. Далее полный список режимов открытия файла

|Режим|Описание|
|---|---|
|r|Только для чтения.|
|w|Только для записи. Создаст новый файл, если не найдет с указанным именем.|
|rb|Только для чтения (бинарный).|
|wb|Только для записи (бинарный). Создаст новый файл, если не найдет с указанным именем.|
|r+|Для чтения и записи.|
|rb+|Для чтения и записи (бинарный).|
|w+|Для чтения и записи. Создаст новый файл для записи, если не найдет с указанным именем.|
|wb+|Для чтения и записи (бинарный). Создаст новый файл для записи, если не найдет с указанным именем.|
|a|Откроет для добавления нового содержимого. Создаст новый файл для записи, если не найдет с указанным именем.|
|a+|Откроет для добавления нового содержимого. Создаст новый файл для чтения записи, если не найдет с указанным именем.|
|ab|Откроет для добавления нового содержимого (бинарный). Создаст новый файл для записи, если не найдет с указанным именем.|
|ab+|Откроет для добавления нового содержимого (бинарный). Создаст новый файл для чтения записи, если не найдет с указанным именем.|

### Пример

Создадим текстовый файл `example.txt` и сохраним его в рабочей директории.

![Текстовый файл пример](https://pythonru.com/wp-content/uploads/2019/11/tekstovyj-fajl-primer.jpg "Текстовый файл пример")

Следующий код используется для его открытия.

```py
f = open('example.txt','r')  # открыть файл из рабочей директории в режиме чтения
fp = open('C:/xyz.txt','r')  # открыть файл из любого каталога
```

В этом примере `f` — переменная-указатель на файл `example.txt`.

Следующий код используется для вывода содержимого файла и информации о нем.

```py
>>> print(*f) # выводим содержимое файла
This is a text file.
>>> print(f) # выводим объект
<_io.TextIOWrapper name='example.txt' mode='r' encoding='cp1252'>
```

Стоит обратить внимание, что в Windows стандартной кодировкой является `cp1252`, а в Linux — `utf-08`.

## Закрытие файла

### Метод close()

После открытия файла в Python его нужно закрыть. Таким образом освобождаются ресурсы и убирается мусор. Python автоматически закрывает файл, когда объект присваивается другому файлу.

Существуют следующие способы:

**Способ №1**

Проще всего после открытия файла закрыть его, используя метод `close()`.

```py
f = open('example.txt','r')
# работа с файлом
f.close()
```

После закрытия этот файл нельзя будет использовать до тех пор, пока заново его не открыть.

**Способ №2**

Также можно написать `try/finally`, которое гарантирует, что если после открытия файла операции с ним приводят к исключениям, он закроется автоматически.

Без него программа завершается некорректно.

Вот как сделать это исключение:

```py
f = open('example.txt','r')
try:
   # работа с файлом
finally:
   f.close()
```

> Файл нужно открыть до инструкции `try`, потому что если инструкция `open` сама по себе вызовет ошибку, то файл не будет открываться для последующего закрытия.

Этот метод гарантирует, что если операции над файлом вызовут исключения, то он закроется до того как программа остановится.

**Способ №3**

### Инструкция with

Еще один подход — использовать инструкцию `with`, которая упрощает обработку исключений с помощью инкапсуляции начальных операций, а также задач по закрытию и очистке.

  

В таком случае инструкция `close` не нужна, потому что `with` автоматически закроет файл.

Вот как это реализовать в коде.

```py
with open('example.txt') as f:
    # работа с файлом
```

## Чтение и запись файлов в Python

В Python файлы можно читать или записывать информацию в них с помощью соответствующих режимов.

### Функция read()

Функция `read()` используется для чтения содержимого файла после открытия его в режиме чтения (`r`).

**Синтаксис**

```py
file.read(size)
```

Где,

- `file` = объект файла
- `size` = количество символов, которые нужно прочитать. Если не указать, то файл прочитается целиком.

**Пример**

```py
>>> f = open('example.txt','r')
>>> f.read(7)  # чтение 7 символов из example.txt
'This is '
```

[Интерпретатор](https://pythonru.com/baza-znanij/onlajn-redaktor-koda-dlja-novichkov-pythontutor-com) прочитал 7 символов файла и если снова использовать функцию `read()`, то чтение начнется с 8-го символа.

```py
>>> f.read(7)  # чтение следующих 7 символов
' a text'
```

### Функция readline()

Функция `readline()` используется для построчного чтения содержимого файла. Она используется для крупных файлов. С ее помощью можно получать доступ к любой строке в любой момент.

**Пример**

Создадим файл `test.txt` с нескольким строками:

```py
This is line1.
This is line2.
This is line3.
```

Посмотрим, как функция `readline()` работает в `test.txt`.

```py
>>> x = open('test.txt','r')
>>> x.readline()  # прочитать первую строку
This is line1.
>>> x.readline(2)  # прочитать вторую строку
This is line2.
>>> x.readlines()  # прочитать все строки
['This is line1.','This is line2.','This is line3.']
```

Обратите внимание, как в последнем случае строки отделены друг от друга.

### Функция write()

Функция `write()` используется для записи в файлы Python, открытые в режиме записи.

Если пытаться открыть файл, которого не существует, в этом режиме, тогда будет создан новый.

**Синтаксис**

```py
file.write(string)
```

**Пример**

  

Предположим, файла `xyz.txt` не существует. Он будет создан при попытке открыть его в режиме чтения.

```py
>>> f = open('xyz.txt','w')  # открытие в режиме записи
>>> f.write('Hello \n World')  # запись Hello World в файл
Hello
World
>>> f.close()  # закрытие файла
```

## Переименование файлов в Python

### Функция rename()

Функция `rename()` используется для переименовывания файлов в Python. Для ее использования сперва нужно импортировать [модуль os](https://pythonru.com/osnovy/rabota-s-fajlami-v-python-s-pomoshhju-modulja-os).

Синтаксис следующий.

```py
import os
os.rename(src,dest)
```

Где,

- `src` = файл, который нужно переименовать
- `dest` = новое имя файла

**Пример**

```py
>>> import os
>>> # переименование xyz.txt в abc.txt
>>> os.rename("xyz.txt","abc.txt")
```

## Текущая позиция в файлах Python

В Python возможно узнать текущую позицию в файле с помощью функции `tell()`. Таким же образом можно изменить текущую позицию командой `seek()`.

**Пример**

```py
>>> f = open('example.txt')  # example.txt, который мы создали ранее
>>> f.read(4)  # давайте сначала перейдем к 4-й позиции
This
>>> f.tell()  # возвращает текущую позицию
4
>>> f.seek(0,0)  # вернем положение на 0 снова
```

## Методы файла в Python

|`file.close()`|закрывает открытый файл|


| `file.fileno()`             | возвращает целочисленный дескриптор файла                                                          |
| --------------------------- | -------------------------------------------------------------------------------------------------- |
| `file.flush()`              | очищает внутренний буфер                                                                           |
| `file.isatty()`             | возвращает True, если файл привязан к терминалу                                                    |
| `file.next()`               | возвращает следующую строку файла                                                                  |
| `file.read(n)`              | чтение первых n символов файла                                                                     |
| `file.readline()`           | читает одну строчку строки или файла                                                               |
| `file.readlines()`          | читает и возвращает список всех строк в файле                                                      |
| `file.seek(offset[,whene])` | устанавливает текущую позицию в файле                                                              |
| `file.seekable()`           | проверяет, поддерживает ли файл случайный доступ. Возвращает `True`, если да                       |
| `file.tell()`               | возвращает текущую позицию в файле                                                                 |
| `file.truncate(n)`          | уменьшает размер файл. Если n указала, то файл обрезается до n байт, если нет — до текущей позиции |
| `file.write(str)`           | добавляет [строку](https://pythonru.com/osnovy/stroki-python) `str` в файл                         |
| `file.writelines(sequence)` | добавляет последовательность строк в файл                                                          |